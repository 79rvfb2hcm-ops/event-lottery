<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ãŠç¥­ã‚Šã‚¬ãƒ©ã‚¬ãƒ©æŠ½é¸</title>
<style>
  :root{
    --bg:#fff3d6;
    --red:#e53935;
    --ink:#1f2937;
    --card:#ffffff;
    --muted:#6b7280;
    --shadow:0 14px 40px rgba(0,0,0,.18);
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:-apple-system,BlinkMacSystemFont,"Hiragino Kaku Gothic ProN","Noto Sans JP",sans-serif;
    background:
      radial-gradient(900px 520px at 50% -10%, rgba(255,255,255,.85), transparent 60%),
      linear-gradient(180deg, var(--bg), #ffe8b6);
    color:var(--ink);
  }
  .wrap{max-width:520px;margin:0 auto;padding:18px}
  .card{
    background:var(--card);
    border-radius:18px;
    padding:18px;
    box-shadow:var(--shadow);
    border:1px solid rgba(0,0,0,.06);
    text-align:center;
  }

  /* å±‹å°ã£ã½ã„è¦‹å‡ºã— */
  .stall{
    border-radius:16px;
    padding:12px 12px 14px;
    background:
      repeating-linear-gradient(90deg, rgba(229,57,53,.95) 0 18px, rgba(255,255,255,.95) 18px 36px);
    box-shadow:0 10px 18px rgba(0,0,0,.12);
    position:relative;
    overflow:hidden;
  }
  .stall h1{
    margin:0;
    font-size:22px;
    font-weight:1000;
    letter-spacing:.06em;
    color:#111;
    background:rgba(255,255,255,.85);
    display:inline-block;
    padding:6px 12px;
    border-radius:999px;
  }
  .lanterns{margin-top:8px;font-size:22px}
  .hint{margin:12px 0 14px;color:var(--muted);font-size:13px;line-height:1.5}

  /* ã‚¬ãƒ©ã‚¬ãƒ©æœ¬ä½“ */
  .gachaWrap{
    margin:10px auto 12px;
    width:min(360px,100%);
    padding:14px;
    border-radius:18px;
    background:linear-gradient(180deg,#fff, #fff7e6);
    border:1px solid rgba(0,0,0,.06);
    position:relative;
  }
  .machine{
    width:190px;height:190px;border-radius:24px;
    margin:0 auto;
    background:linear-gradient(180deg,#c81d25,#a50f15);
    box-shadow:0 16px 30px rgba(0,0,0,.2);
    position:relative;
    overflow:hidden;
  }
  .machine::before{
    content:"";
    position:absolute;inset:10px;
    border-radius:18px;
    background:
      radial-gradient(110px 90px at 35% 30%, rgba(255,255,255,.25), transparent 60%),
      linear-gradient(180deg, rgba(255,255,255,.10), rgba(0,0,0,.08));
    border:1px solid rgba(255,255,255,.18);
  }
  .window{
    position:absolute;left:24px;right:24px;top:26px;height:86px;
    border-radius:14px;
    background:linear-gradient(180deg, rgba(255,255,255,.40), rgba(255,255,255,.14));
    border:1px solid rgba(255,255,255,.25);
    overflow:hidden;
  }
  .roller{
    position:absolute;inset:-30px;
    border-radius:50%;
    background:
      conic-gradient(from 0deg,
        rgba(255,255,255,.18),
        rgba(255,255,255,.06),
        rgba(255,255,255,.18));
    animation:none;
  }
  .spinning .roller{animation:spin .55s linear infinite;}
  @keyframes spin{to{transform:rotate(360deg)}}

  /* å–ã£æ‰‹ */
  .handle{
    position:absolute;right:18px;bottom:28px;
    width:64px;height:64px;border-radius:50%;
    background:linear-gradient(180deg,#fef3c7,#f59e0b);
    border:1px solid rgba(255,255,255,.35);
    box-shadow:0 12px 18px rgba(0,0,0,.2);
  }
  .handle::after{
    content:"";
    position:absolute;left:50%;top:50%;
    width:14px;height:14px;border-radius:50%;
    transform:translate(-50%,-50%);
    background:#fff;
    opacity:.9;
  }
  .spinning .handle{animation:knob .55s linear infinite;}
  @keyframes knob{to{transform:rotate(360deg)}}

  /* ç‰ã®æ’å‡ºå£ */
  .chute{
    position:absolute;left:50%;bottom:14px;
    width:120px;height:46px;
    transform:translateX(-50%);
    border-radius:999px;
    background:rgba(0,0,0,.20);
    border:1px solid rgba(255,255,255,.12);
    overflow:hidden;
  }
  .ball{
    position:absolute;left:50%;top:-58px;
    width:48px;height:48px;border-radius:50%;
    transform:translateX(-50%);
    display:none;
    border:1px solid rgba(255,255,255,.35);
    box-shadow:0 16px 22px rgba(0,0,0,.25);
  }
  .ball.white{
    background:
      radial-gradient(circle at 30% 30%, rgba(255,255,255,.95), rgba(255,255,255,0) 45%),
      radial-gradient(circle at 70% 70%, rgba(0,0,0,.22), rgba(0,0,0,0) 60%),
      linear-gradient(180deg,#ffffff,#e5e7eb);
  }
  .ball.silver{
    background:
      radial-gradient(circle at 30% 30%, rgba(255,255,255,.95), rgba(255,255,255,0) 45%),
      radial-gradient(circle at 70% 70%, rgba(0,0,0,.22), rgba(0,0,0,0) 60%),
      linear-gradient(180deg,#e5e7eb,#9ca3af);
  }
  .ball.gold{
    background:
      radial-gradient(circle at 30% 30%, rgba(255,255,255,.95), rgba(255,255,255,0) 45%),
      radial-gradient(circle at 70% 70%, rgba(0,0,0,.22), rgba(0,0,0,0) 60%),
      linear-gradient(180deg,#fde68a,#f59e0b);
  }
  .drop{display:block; animation:drop .85s cubic-bezier(.22,.95,.22,1) forwards;}
  @keyframes drop{
    0%{top:-58px}
    75%{top:4px}
    100%{top:6px}
  }

  /* ãƒœã‚¿ãƒ³ */
  .btn{
    width:100%;
    padding:16px 14px;
    border:none;border-radius:16px;
    font-size:18px;font-weight:1000;
    background:var(--red);color:#fff;
  }
  .btn:disabled{opacity:.6}
  .sub{margin-top:10px;color:var(--muted);font-size:12px;line-height:1.5}

  /* çµæœ */
  .result{
    display:none;
    margin-top:12px;
    padding:14px;
    border-radius:16px;
    border:1px solid rgba(0,0,0,.06);
    background:#fff7e6;
  }
  .rank{font-size:30px;font-weight:1000;margin:6px 0 6px}
  .msg{margin:0 0 6px}
  .code{
    display:inline-block;
    margin-top:8px;
    padding:4px 8px;border-radius:10px;
    background:#111827;color:#fff;
    font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;
    font-size:12px;
  }
</style>
</head>

<body>
<div class="wrap">
  <div class="card">
    <div class="stall">
      <h1>ç¦å¼•ã ã‚¬ãƒ©ã‚¬ãƒ©æŠ½é¸</h1>
      <div class="lanterns">ğŸ®ğŸ®ğŸ®</div>
    </div>

    <div class="hint">
      ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã ã‘ã§æŠ½é¸ï¼<br>
      ç‰ãŒå‡ºãŸã‚‰ã€ã‚¹ã‚¿ãƒƒãƒ•ã«ç”»é¢ã‚’ãŠè¦‹ã›ãã ã•ã„ã€‚
    </div>

    <div class="gachaWrap">
      <div class="machine" id="machine">
        <div class="window">
          <div class="roller"></div>
        </div>
        <div class="handle"></div>
        <div class="chute">
          <div id="ball" class="ball white"></div>
        </div>
      </div>
    </div>

    <button id="drawBtn" class="btn">ã‚¬ãƒ©ã‚¬ãƒ©æŠ½é¸ã™ã‚‹</button>

    <div id="result" class="result">
      <div id="rank" class="rank">â€”</div>
      <p id="msg" class="msg">â€”</p>
      <div style="color:#6b7280;font-size:13px">ã‚¹ã‚¿ãƒƒãƒ•ã«ã“ã®ç”»é¢ã‚’ãŠè¦‹ã›ãã ã•ã„</div>
      <div>ç®¡ç†ã‚³ãƒ¼ãƒ‰ï¼š <span id="code" class="code">â€”</span></div>
    </div>

    <div class="sub">
      â€» å½“æ—¥ãŠä¸€äººæ§˜1å›ï¼ˆç«¯æœ«ç›®å®‰ï¼‰ï¼æ™¯å“ã¯ã‚¹ã‚¿ãƒƒãƒ•ç¢ºèªå¾Œã«ãŠæ¸¡ã—ã—ã¾ã™
    </div>
  </div>
</div>

<script>
  // ===== ç¢ºç‡ï¼ˆå†…éƒ¨ã®ã¿ï¼‰=====
  const PRIZES = [
    { name: "ğŸ† 1ç­‰", rate: 2.5, ball:"gold",  msg: "å¤§å½“ãŸã‚Šï¼ï¼ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼" },
    { name: "ğŸ¥ˆ 2ç­‰", rate: 2.5, ball:"silver",msg: "å½“ãŸã‚Šï¼ã‚„ã£ãŸã­ï¼" },
    { name: "ğŸ¥‰ 3ç­‰", rate: 95.0,ball:"white", msg: "ã”å‚åŠ ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼" },
  ];

  const DAILY_LIMIT = true; // å¿…è¦ãªã‘ã‚Œã° false
  const STORAGE_KEY = "matsuri_garagara_";

  const drawBtn = document.getElementById("drawBtn");
  const machine = document.getElementById("machine");
  const ball = document.getElementById("ball");

  const result = document.getElementById("result");
  const rankEl = document.getElementById("rank");
  const msgEl  = document.getElementById("msg");
  const codeEl = document.getElementById("code");

  function yyyymmdd(d=new Date()){
    const y=d.getFullYear();
    const m=String(d.getMonth()+1).padStart(2,"0");
    const day=String(d.getDate()).padStart(2,"0");
    return `${y}${m}${day}`;
  }
  function alreadyDrawnToday(){
    if(!DAILY_LIMIT) return false;
    return localStorage.getItem(STORAGE_KEY + yyyymmdd()) === "1";
  }
  function setDrawnToday(){
    if(!DAILY_LIMIT) return;
    localStorage.setItem(STORAGE_KEY + yyyymmdd(), "1");
  }
  function pickPrize(){
    const r = Math.random()*100;
    let acc = 0;
    for(const p of PRIZES){
      acc += p.rate;
      if(r < acc) return p;
    }
    return PRIZES[PRIZES.length-1];
  }
  function makeCode(prizeName){
    const rand = Math.floor(Math.random()*900000)+100000;
    return `${yyyymmdd()}-${prizeName.replace(/\s/g,"")}-${rand}`;
  }
  function lockAsDone(){
    drawBtn.disabled = true;
    drawBtn.textContent = "æœ¬æ—¥ã¯æŠ½é¸æ¸ˆã¿";
    result.style.display = "block";
    rankEl.textContent = "âœ… ä»Šæ—¥ã¯æŠ½é¸æ¸ˆã¿ã§ã™";
    msgEl.textContent = "æã‚Œå…¥ã‚Šã¾ã™ãŒã€æœ¬æ—¥ã®æŠ½é¸ã¯çµ‚äº†ã§ã™ã€‚ã‚¹ã‚¿ãƒƒãƒ•ã«ãŠå£°ãŒã‘ãã ã•ã„ã€‚";
    codeEl.textContent = `${yyyymmdd()}-DONE`;
  }

  if(alreadyDrawnToday()) lockAsDone();

  drawBtn.addEventListener("click", ()=>{
    if(alreadyDrawnToday()) return lockAsDone();

    drawBtn.disabled = true;

    const prize = pickPrize(); // è£ã§æ±ºã‚ã‚‹

    // ã‚¬ãƒ©ã‚¬ãƒ©æ¼”å‡ºé–‹å§‹
    machine.classList.add("spinning");
    result.style.display = "none";

    // ç‰ã®è‰²ã‚’ã‚»ãƒƒãƒˆ
    ball.className = "ball " + prize.ball;

    // æ¼”å‡ºæ™‚é–“ï¼ˆä½“æ„Ÿã¡ã‚‡ã†ã©è‰¯ã„ï¼‰
    setTimeout(()=>{
      // ç‰ã‚’å‡ºã™
      ball.classList.remove("drop");
      void ball.offsetWidth;
      ball.classList.add("drop");
    }, 900);

    setTimeout(()=>{
      // æ¼”å‡ºåœæ­¢
      machine.classList.remove("spinning");

      // çµæœè¡¨ç¤º
      setDrawnToday();
      rankEl.textContent = prize.name;
      msgEl.textContent = prize.msg;
      codeEl.textContent = makeCode(prize.name);
      result.style.display = "block";
    }, 1700);
  });
</script>
</body>
</html>
