<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ã‚¬ãƒãƒ£æŠ½é¸</title>
<style>
  :root{
    --bg:#0f172a;
    --panel:#111827;
    --panel2:#0b1220;
    --accent:#ef4444;
    --accent2:#22c55e;
    --gold:#fbbf24;
    --silver:#93c5fd;
    --text:#e5e7eb;
    --muted:#9ca3af;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:-apple-system,BlinkMacSystemFont,"Hiragino Kaku Gothic ProN","Noto Sans JP",sans-serif;
    background: radial-gradient(1200px 700px at 50% -10%, #1f2937 0%, var(--bg) 55%, #050814 100%);
    color:var(--text);
  }
  .wrap{max-width:520px;margin:0 auto;padding:18px}
  .title{
    text-align:center;margin:6px 0 12px;
    font-weight:900;letter-spacing:.03em;
    font-size:22px;
  }
  .card{
    background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
    border:1px solid rgba(255,255,255,.12);
    border-radius:18px;
    padding:16px;
    box-shadow:0 16px 50px rgba(0,0,0,.35);
  }
  .hint{margin:10px 0 14px;text-align:center;color:var(--muted);font-size:13px;line-height:1.5}

  /* ===== ã‚¬ãƒãƒ£ç­ä½“ ===== */
  .machine{
    position:relative;
    width:100%;
    aspect-ratio: 1 / 1.2;
    border-radius:22px;
    background:
      linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04)),
      radial-gradient(120px 80px at 30% 20%, rgba(255,255,255,.10), transparent 60%),
      radial-gradient(120px 80px at 70% 20%, rgba(255,255,255,.08), transparent 60%),
      linear-gradient(180deg, #111827, #0b1220);
    border:1px solid rgba(255,255,255,.12);
    overflow:hidden;
  }
  .topStripe{
    position:absolute;left:0;right:0;top:0;height:12%;
    background: repeating-linear-gradient(90deg, rgba(239,68,68,.85) 0 18px, rgba(255,255,255,.85) 18px 36px);
    filter: drop-shadow(0 8px 12px rgba(0,0,0,.25));
  }
  .logo{
    position:absolute;top:6%;left:50%;transform:translateX(-50%);
    padding:6px 12px;border-radius:999px;
    background:rgba(0,0,0,.35);
    border:1px solid rgba(255,255,255,.16);
    font-weight:900;font-size:13px;letter-spacing:.08em;
  }

  /* é€æ˜ãƒ‰ãƒ¼ãƒ  */
  .dome{
    position:absolute;left:10%;right:10%;top:14%;height:40%;
    border-radius:22px;
    background: radial-gradient(120px 90px at 30% 25%, rgba(255,255,255,.18), transparent 60%),
                linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.03));
    border:1px solid rgba(255,255,255,.18);
    overflow:hidden;
  }
  .balls{
    position:absolute;inset:0;
    display:flex;flex-wrap:wrap;align-content:flex-end;
    gap:10px;padding:14px;
    opacity:.95;
  }
  .ball{
    width:28px;height:28px;border-radius:50%;
    background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.85), rgba(255,255,255,0) 45%),
                radial-gradient(circle at 70% 70%, rgba(0,0,0,.35), rgba(0,0,0,0) 55%),
                var(--c);
    border:1px solid rgba(255,255,255,.18);
    transform:translateY(0);
    animation:floaty 2.8s ease-in-out infinite;
  }
  .ball:nth-child(2n){animation-duration:3.4s}
  .ball:nth-child(3n){animation-duration:4.1s}
  @keyframes floaty{
    0%,100%{transform:translateY(0)}
    50%{transform:translateY(-8px)}
  }

  /* ä¸‹éƒ¨æ“ä½œãƒ‘ãƒãƒ« */
  .panel{
    position:absolute;left:0;right:0;bottom:0;height:40%;
    background: linear-gradient(180deg, rgba(0,0,0,.0), rgba(0,0,0,.20) 10%, rgba(0,0,0,.32)),
                linear-gradient(180deg, #0b1220, #050814);
    border-top:1px solid rgba(255,255,255,.10);
  }
  .panelInner{
    position:absolute;left:8%;right:8%;top:10%;bottom:10%;
    display:grid;
    grid-template-columns: 1.2fr .8fr;
    gap:12px;
    align-items:center;
  }

  /* æŠ•å…¥å£ */
  .coinBox{
    background: rgba(255,255,255,.05);
    border:1px solid rgba(255,255,255,.12);
    border-radius:16px;
    padding:12px;
  }
  .coinSlot{
    height:14px;border-radius:999px;
    background: rgba(0,0,0,.55);
    border:1px solid rgba(255,255,255,.10);
    margin:10px 0 6px;
    position:relative;
    overflow:hidden;
  }
  .coin{
    width:28px;height:28px;border-radius:50%;
    background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.85), rgba(255,255,255,0) 45%),
                radial-gradient(circle at 70% 70%, rgba(0,0,0,.35), rgba(0,0,0,0) 55%),
                linear-gradient(180deg, #fde68a, #f59e0b);
    border:1px solid rgba(255,255,255,.25);
    position:absolute;left:50%;top:-34px;transform:translateX(-50%);
    display:none;
  }
  .coin.drop{
    display:block;
    animation: coinDrop .75s ease-in forwards;
  }
  @keyframes coinDrop{
    0%{top:-34px;opacity:0}
    10%{opacity:1}
    70%{top:-2px}
    100%{top:22px;opacity:0}
  }

  /* ãƒãƒ³ãƒ‰ãƒ« */
  .handleWrap{
    text-align:center;
  }
  .handleBase{
    width:120px;height:120px;border-radius:50%;
    margin:0 auto;
    background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.12), rgba(255,255,255,0) 55%),
                linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
    border:1px solid rgba(255,255,255,.14);
    position:relative;
  }
  .handleKnob{
    width:36px;height:36px;border-radius:50%;
    background: linear-gradient(180deg, #fca5a5, #ef4444);
    border:1px solid rgba(255,255,255,.20);
    position:absolute;left:50%;top:6px;transform:translateX(-50%);
    box-shadow:0 10px 18px rgba(0,0,0,.35);
  }
  .handleLine{
    position:absolute;left:50%;top:18px;width:6px;height:56px;
    transform:translateX(-50%);
    background: rgba(255,255,255,.16);
    border-radius:999px;
  }
  .spin .handleBase{animation:spin 0.95s ease-in-out 1;}
  @keyframes spin{
    0%{transform:rotate(0deg)}
    100%{transform:rotate(360deg)}
  }

  /* æ’å‡ºå£ & ã‚«ãƒ—ã‚»ãƒ« */
  .chute{
    position:absolute;left:50%;bottom:10%;
    width:72%;max-width:320px;height:70px;
    transform:translateX(-50%);
    border-radius:16px;
    background: rgba(0,0,0,.35);
    border:1px solid rgba(255,255,255,.10);
    overflow:hidden;
  }
  .capsule{
    position:absolute;left:50%;top:-54px;
    width:54px;height:54px;border-radius:50%;
    transform:translateX(-50%);
    background:
      radial-gradient(circle at 30% 30%, rgba(255,255,255,.85), rgba(255,255,255,0) 45%),
      linear-gradient(180deg, #60a5fa 0 50%, #fb7185 50% 100%);
    border:1px solid rgba(255,255,255,.22);
    display:none;
  }
  .capsule.drop{display:block; animation:capsuleDrop .85s cubic-bezier(.25,.9,.25,1) forwards;}
  @keyframes capsuleDrop{
    0%{top:-54px}
    75%{top:8px}
    100%{top:10px}
  }

  /* ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼ˆé–‹ã‘ã‚‹æ¼”å‡ºï¼‰ */
  .overlay{
    position:fixed;inset:0;
    background:rgba(0,0,0,.60);
    display:none;
    align-items:center;justify-content:center;
    padding:18px;
    z-index:50;
  }
  .modal{
    width:min(520px,100%);
    background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
    border:1px solid rgba(255,255,255,.14);
    border-radius:18px;
    padding:16px;
    text-align:center;
    box-shadow:0 18px 60px rgba(0,0,0,.5);
  }
  .bigCapsule{
    width:140px;height:140px;border-radius:50%;
    margin:6px auto 10px;
    background:
      radial-gradient(circle at 30% 30%, rgba(255,255,255,.85), rgba(255,255,255,0) 45%),
      linear-gradient(180deg, #60a5fa 0 50%, #fb7185 50% 100%);
    border:1px solid rgba(255,255,255,.22);
    position:relative;
  }
  .bigCapsule::after{
    content:"";
    position:absolute;left:8%;right:8%;top:50%;
    height:2px;background:rgba(255,255,255,.35);
  }
  .shake{animation:shake .55s ease-in-out 1;}
  @keyframes shake{
    0%,100%{transform:rotate(0deg)}
    20%{transform:rotate(-6deg)}
    40%{transform:rotate(6deg)}
    60%{transform:rotate(-5deg)}
    80%{transform:rotate(5deg)}
  }

  .btnRow{display:grid;gap:10px;margin-top:10px}
  button{
    border:none;border-radius:14px;
    padding:14px 14px;
    font-size:17px;font-weight:900;
    color:#0b1220;
    background:#f3f4f6;
  }
  .primary{background:linear-gradient(180deg, #fef08a, #f59e0b); }
  .danger{background:linear-gradient(180deg, #fca5a5, #ef4444); color:#fff;}
  .success{background:linear-gradient(180deg, #86efac, #22c55e); color:#052e1a;}
  button:disabled{opacity:.55}

  .resultBox{
    margin-top:12px;
    border-radius:16px;
    padding:14px;
    display:none;
    border:1px solid rgba(255,255,255,.14);
    background: rgba(255,255,255,.06);
  }
  .rank{
    font-size:30px;font-weight:1000;margin:6px 0 8px;
    letter-spacing:.04em;
  }
  .r1{background:rgba(251,191,36,.18)}
  .r2{background:rgba(147,197,253,.16)}
  .r3{background:rgba(156,163,175,.14)}
  .code{
    display:inline-block;
    padding:4px 8px;border-radius:10px;
    background:rgba(0,0,0,.35);
    border:1px solid rgba(255,255,255,.14);
    font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;
    font-size:13px;
  }

  .foot{margin-top:12px;color:var(--muted);font-size:12px;line-height:1.5;text-align:center}
</style>
</head>
<body>
<div class="wrap">
  <div class="title">ğŸ° ã‚¬ãƒãƒ£æŠ½é¸ ğŸ°</div>

  <div class="card">
    <div class="hint">
      ã€Œ100å††æŠ•å…¥ã€â†’ã€Œãƒãƒ³ãƒ‰ãƒ«ã‚’å›ã™ã€â†’ ã‚«ãƒ—ã‚»ãƒ«ã‚’é–‹ã‘ã¦çµæœï¼
    </div>

    <div class="machine" id="machine">
      <div class="topStripe"></div>
      <div class="logo">GACHA LOTTERY</div>

      <div class="dome">
        <div class="balls" aria-hidden="true">
          <div class="ball" style="--c:#60a5fa"></div>
          <div class="ball" style="--c:#fb7185"></div>
          <div class="ball" style="--c:#34d399"></div>
          <div class="ball" style="--c:#fbbf24"></div>
          <div class="ball" style="--c:#a78bfa"></div>
          <div class="ball" style="--c:#f97316"></div>
          <div class="ball" style="--c:#22d3ee"></div>
          <div class="ball" style="--c:#f472b6"></div>
          <div class="ball" style="--c:#84cc16"></div>
          <div class="ball" style="--c:#e879f9"></div>
        </div>
      </div>

      <div class="panel">
        <div class="panelInner">
          <div class="coinBox">
            <div style="font-weight:900">100å††æŠ•å…¥</div>
            <div class="coinSlot">
              <div id="coin" class="coin"></div>
            </div>
            <button id="insertBtn" class="success">100å††ã‚’å…¥ã‚Œã‚‹</button>
          </div>

          <div class="handleWrap" id="handleWrap">
            <div style="font-weight:900;margin-bottom:8px">ãƒãƒ³ãƒ‰ãƒ«</div>
            <div class="handleBase" id="handleBase">
              <div class="handleKnob"></div>
              <div class="handleLine"></div>
            </div>
            <button id="spinBtn" class="danger" disabled>å›ã™ï¼</button>
          </div>
        </div>

        <div class="chute">
          <div id="capsule" class="capsule"></div>
        </div>
      </div>
    </div>

    <div id="resultBox" class="resultBox">
      <div id="rank" class="rank">â€”</div>
      <div id="msg">â€”</div>
      <div style="margin-top:8px;color:var(--muted);font-size:13px">
        ã‚¹ã‚¿ãƒƒãƒ•ã«ã“ã®ç”»é¢ã‚’ãŠè¦‹ã›ãã ã•ã„
      </div>
      <div style="margin-top:10px;color:var(--muted);font-size:12px">
        ç®¡ç†ã‚³ãƒ¼ãƒ‰ï¼š <span id="code" class="code">â€”</span>
      </div>
    </div>

    <div class="foot">
      â€» å½“æ—¥ãŠä¸€äººæ§˜1å›ï¼ˆç«¯æœ«ç›®å®‰ï¼‰ï¼æ™¯å“ã¯ã‚¹ã‚¿ãƒƒãƒ•ç¢ºèªå¾Œã«ãŠæ¸¡ã—ã—ã¾ã™
    </div>
  </div>
</div>

<!-- é–‹ã‘ã‚‹ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="overlay" class="overlay">
  <div class="modal">
    <div style="font-weight:1000;letter-spacing:.05em">ã‚«ãƒ—ã‚»ãƒ«ã‚’é–‹ã‘ã¦ã­ï¼</div>
    <div id="bigCapsule" class="bigCapsule"></div>
    <div class="btnRow">
      <button id="openBtn" class="primary">ã‚«ãƒ—ã‚»ãƒ«ã‚’é–‹ã‘ã‚‹</button>
      <button id="closeBtn">é–‰ã˜ã‚‹</button>
    </div>
    <div style="margin-top:8px;color:var(--muted);font-size:12px">
      â€» é–‹ã‘ã‚‹å‰ã«æˆ»ã‚‹ã¨çµæœãŒè¦‹ãˆã¾ã›ã‚“
    </div>
  </div>
</div>

<script>
  // ===== ç¢ºç‡ï¼ˆå†…éƒ¨ã®ã¿ï¼‰=====
  const PRIZES = [
    { name: "ğŸ† 1ç­‰", rate: 2.5, cls: "r1", msg: "å¤§å½“ãŸã‚Šï¼ï¼ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼" },
    { name: "ğŸ¥ˆ 2ç­‰", rate: 2.5, cls: "r2", msg: "å½“ãŸã‚Šï¼ã‚„ã£ãŸã­ï¼" },
    { name: "ğŸ¥‰ 3ç­‰", rate: 95.0, cls: "r3", msg: "ã”å‚åŠ ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼" },
  ];

  // ç«¯æœ«ã”ã¨å½“æ—¥1å›ï¼ˆå¿…è¦ãªã‘ã‚Œã° false ã«ï¼‰
  const DAILY_LIMIT = true;
  const STORAGE_KEY = "gacha_lottery_draw_";

  const insertBtn = document.getElementById("insertBtn");
  const spinBtn = document.getElementById("spinBtn");
  const coin = document.getElementById("coin");
  const handleWrap = document.getElementById("handleWrap");
  const handleBase = document.getElementById("handleBase");
  const capsule = document.getElementById("capsule");

  const overlay = document.getElementById("overlay");
  const openBtn = document.getElementById("openBtn");
  const closeBtn = document.getElementById("closeBtn");
  const bigCapsule = document.getElementById("bigCapsule");

  const resultBox = document.getElementById("resultBox");
  const rankEl = document.getElementById("rank");
  const msgEl = document.getElementById("msg");
  const codeEl = document.getElementById("code");

  let selectedPrize = null;
  let coinInserted = false;

  function yyyymmdd(d=new Date()){
    const y=d.getFullYear();
    const m=String(d.getMonth()+1).padStart(2,"0");
    const day=String(d.getDate()).padStart(2,"0");
    return `${y}${m}${day}`;
  }
  function alreadyDrawnToday(){
    if(!DAILY_LIMIT) return false;
    return localStorage.getItem(STORAGE_KEY + yyyymmdd()) === "1";
  }
  function setDrawnToday(){
    if(!DAILY_LIMIT) return;
    localStorage.setItem(STORAGE_KEY + yyyymmdd(), "1");
  }

  function pickPrize(){
    const r = Math.random() * 100;
    let acc = 0;
    for(const p of PRIZES){
      acc += p.rate;
      if(r < acc) return p;
    }
    return PRIZES[PRIZES.length-1];
  }

  function makeCode(prizeName){
    const rand = Math.floor(Math.random()*900000)+100000;
    return `${yyyymmdd()}-${prizeName.replace(/\s/g,"")}-${rand}`;
  }

  function lockAsDone(){
    insertBtn.disabled = true;
    spinBtn.disabled = true;
    insertBtn.textContent = "æœ¬æ—¥ã¯æŠ½é¸æ¸ˆã¿";
    spinBtn.textContent = "æœ¬æ—¥ã¯æŠ½é¸æ¸ˆã¿";
    resultBox.style.display = "block";
    resultBox.className = "resultBox r3";
    rankEl.textContent = "âœ… ä»Šæ—¥ã¯æŠ½é¸æ¸ˆã¿ã§ã™";
    msgEl.textContent = "æã‚Œå…¥ã‚Šã¾ã™ãŒã€æœ¬æ—¥ã®æŠ½é¸ã¯çµ‚äº†ã§ã™ã€‚ã‚¹ã‚¿ãƒƒãƒ•ã«ãŠå£°ãŒã‘ãã ã•ã„ã€‚";
    codeEl.textContent = `${yyyymmdd()}-DONE`;
  }

  if(alreadyDrawnToday()){
    lockAsDone();
  }

  insertBtn.addEventListener("click", ()=>{
    if(alreadyDrawnToday()) return lockAsDone();

    // è£ã§çµæœã¯æ±ºã‚ã¦ãŠãï¼ˆè¦‹ã›ã‚‹ã®ã¯å¾Œï¼‰
    selectedPrize = pickPrize();

    // ã‚³ã‚¤ãƒ³æ¼”å‡º
    coin.classList.remove("drop");
    void coin.offsetWidth; // å†ç”Ÿãƒˆãƒªã‚¬ãƒ¼
    coin.classList.add("drop");

    coinInserted = true;
    insertBtn.disabled = true;
    insertBtn.textContent = "æŠ•å…¥æ¸ˆã¿";
    spinBtn.disabled = false;
  });

  spinBtn.addEventListener("click", ()=>{
    if(!coinInserted || !selectedPrize) return;
    spinBtn.disabled = true;

    // ãƒãƒ³ãƒ‰ãƒ«å›è»¢æ¼”å‡º
    handleWrap.classList.remove("spin");
    void handleWrap.offsetWidth;
    handleWrap.classList.add("spin");

    // ã‚«ãƒ—ã‚»ãƒ«è½ä¸‹ï¼ˆãƒãƒ³ãƒ‰ãƒ«å›è»¢ã«åˆã‚ã›ã‚‹ï¼‰
    setTimeout(()=>{
      capsule.classList.remove("drop");
      void capsule.offsetWidth;
      capsule.classList.add("drop");
    }, 650);

    // è½ã¡ãŸã‚‰ã€Œé–‹ã‘ã‚‹ã€ã¸
    setTimeout(()=>{
      overlay.style.display = "flex";
      bigCapsule.classList.remove("shake");
      void bigCapsule.offsetWidth;
      bigCapsule.classList.add("shake");
    }, 1250);
  });

  openBtn.addEventListener("click", ()=>{
    // çµæœç¢ºå®šï¼ˆã“ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã€Œè¦‹ã›ã‚‹ã€ï¼‰
    setDrawnToday();

    resultBox.style.display = "block";
    resultBox.className = "resultBox " + selectedPrize.cls;
    rankEl.textContent = selectedPrize.name;
    msgEl.textContent = selectedPrize.msg;
    codeEl.textContent = makeCode(selectedPrize.name);

    overlay.style.display = "none";

    // ä»¥é™ã¯è§¦ã‚Œãªã„ã‚ˆã†ã«
    openBtn.disabled = true;
    closeBtn.textContent = "é–‰ã˜ã‚‹";
  });

  closeBtn.addEventListener("click", ()=>{
    overlay.style.display = "none";
  });
</script>
</body>
</html>
